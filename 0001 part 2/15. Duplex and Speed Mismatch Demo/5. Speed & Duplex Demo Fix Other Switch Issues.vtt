WEBVTT

00:00.690 --> 00:03.300
Instructor: So we now need to fix this link

00:03.300 --> 00:07.950
between 2951 and 2952.

00:07.950 --> 00:12.270
Both switches are showing messages

00:12.270 --> 00:13.923
that there's a duplex problem.

00:15.090 --> 00:17.170
So CDP does a nice job here

00:18.720 --> 00:20.570
of showing us that there's a problem.

00:21.600 --> 00:26.600
Write show run interface f0/4.

00:26.670 --> 00:29.850
We can see the speed and duplex are hard coded.

00:29.850 --> 00:32.613
Show run interface f0/4.

00:33.750 --> 00:36.120
On this side, it's 100 half duplex,

00:36.120 --> 00:38.793
on this side, it's 100 full duplex.

00:42.510 --> 00:45.663
So that's a simple fix of setting the duplex to full.

00:47.310 --> 00:50.913
The interface has gone down and comes up again,

00:53.370 --> 00:56.100
and hopefully that's resolved the problem.

00:56.100 --> 00:59.580
We could clear the counters as an example,

00:59.580 --> 01:03.663
on F0/4, and do the same here.

01:05.250 --> 01:08.437
Clear counters f0/4,

01:09.420 --> 01:13.710
and then we could after a while look at those counters

01:13.710 --> 01:15.873
and see if we find any problems.

01:17.100 --> 01:19.380
But that should have solved the problem

01:19.380 --> 01:20.883
of a duplex mismatch.

01:22.740 --> 01:25.803
To confirm it, show interface f0/4.

01:27.120 --> 01:29.493
Right at the top here we can see,

01:30.840 --> 01:32.490
so here's the command,

01:32.490 --> 01:35.910
here's the speed and duplex of the interface.

01:35.910 --> 01:38.610
Interface is up up, and it's connected.

01:38.610 --> 01:42.003
Show interface f0/4 on switch two.

01:43.800 --> 01:45.483
Here's the command, once again.

01:47.190 --> 01:51.360
Duplex and speed are shown here as well.

01:51.360 --> 01:54.180
Interface is up up, and it's connected.

01:54.180 --> 01:59.180
We are not seeing any errors on this interface,

01:59.940 --> 02:04.890
and on this one we are also not seeing any errors.

02:04.890 --> 02:08.550
So that hopefully has resolved the problem

02:08.550 --> 02:11.700
on this link and this link.

02:11.700 --> 02:16.200
So be careful hard coding speed and duplex.

02:16.200 --> 02:20.880
Auto negotiation may negotiate correctly, but it may not.

02:20.880 --> 02:24.000
Generally today with gigabit and faster links

02:24.000 --> 02:27.540
your problems are not as bad as they used to be

02:27.540 --> 02:29.700
on 10/100 links.

02:29.700 --> 02:33.090
Let's see what happens if we configure speed and duplex

02:33.090 --> 02:37.470
on one side and leave the other side for auto negotiation.

02:37.470 --> 02:42.010
So on 2951, we will configure this interface

02:44.730 --> 02:49.050
with a speed of 100, duplex of full.

02:49.050 --> 02:50.463
Interface has gone down.

02:51.630 --> 02:54.663
Interface will hopefully come up, and there you go.

02:58.650 --> 03:02.313
Here is the 3750,

03:03.390 --> 03:05.250
and we can see that it's complaining

03:05.250 --> 03:07.290
about a duplex mismatch.

03:07.290 --> 03:12.130
So show run interface f1/0/3.

03:15.450 --> 03:18.930
No duplex or speed is being configured on this interface.

03:18.930 --> 03:22.290
Show interface f1/0/3.

03:22.290 --> 03:25.290
This side is using 100 Mb, half duplex,

03:25.290 --> 03:26.350
whereas this side

03:29.550 --> 03:33.273
is using 100 Mb, full duplex.

03:35.040 --> 03:39.330
So if you have one side configured for auto negotiation,

03:39.330 --> 03:40.980
and the other side is hard coded,

03:42.480 --> 03:45.660
you may have a problem because this side is not negotiating

03:45.660 --> 03:46.950
with the other side,

03:46.950 --> 03:50.010
and this side may take a fallback position.

03:50.010 --> 03:51.660
Sometimes it's able,

03:51.660 --> 03:54.900
especially on gigabit and later interfaces,

03:54.900 --> 03:57.750
to still work out what the other side is using

03:57.750 --> 04:01.230
and set its duplex and speed accordingly.

04:01.230 --> 04:03.990
But here it wasn't able to do that

04:03.990 --> 04:07.140
because the 2950s are older switches.

04:07.140 --> 04:09.510
So to resolve this,

04:09.510 --> 04:14.343
let's configure the 2950 for auto negotiation.

04:16.560 --> 04:20.070
So F0/1, this interface,

04:20.070 --> 04:23.643
speed auto,

04:25.380 --> 04:27.753
duplex auto.

04:29.370 --> 04:33.423
Interface has gone down, hopefully it'll come up,

04:35.310 --> 04:38.790
and hopefully they'll be able to negotiate successfully.

04:38.790 --> 04:43.710
So 3750 is showing up, 2950 is showing up.

04:43.710 --> 04:46.773
Show interface f1/0/3,

04:48.660 --> 04:50.910
full duplex, 100 Mb,

04:50.910 --> 04:54.570
so that side is 100 Mb, full duplex.

04:54.570 --> 04:57.843
Do show interface f0/1,

04:59.370 --> 05:02.550
on this side full duplex, 100 Mb.

05:02.550 --> 05:04.800
So they've negotiated successfully.

05:04.800 --> 05:08.100
So moral of the story is either configure both sides

05:08.100 --> 05:11.493
for auto negotiation, or hard code both sides.

05:12.810 --> 05:15.480
Generally today you're going to allow both sides

05:15.480 --> 05:17.820
to auto negotiate.

05:17.820 --> 05:22.473
Show run interface f1/0/1.

05:24.480 --> 05:28.113
Show run interface f1/0/1.

05:29.040 --> 05:31.896
Now this is the link between the two 3750s,

05:31.896 --> 05:35.643
F1/0/1.

05:36.600 --> 05:38.760
This interface isn't currently connected,

05:38.760 --> 05:42.360
so we've got one interface, F1/0/1,

05:42.360 --> 05:44.820
between the two 3750s.

05:44.820 --> 05:49.820
One side is not set for speed and duplex, it's set for auto.

05:49.860 --> 05:53.040
The other side is using 100 half,

05:53.040 --> 05:54.100
but in this case

05:58.080 --> 06:00.960
the site set for auto negotiation has reverted

06:00.960 --> 06:03.630
to 100 Mb, half duplex.

06:03.630 --> 06:06.390
So that's worked out okay in this example.

06:06.390 --> 06:11.390
However, if I change this to have a duplex of full,

06:13.110 --> 06:15.720
the negotiation will probably fail,

06:15.720 --> 06:17.403
and we'll have a duplex mismatch.

06:18.900 --> 06:20.223
Interfaces have come up.

06:23.190 --> 06:24.453
Let's see what it's done.

06:26.940 --> 06:29.070
In this example, it's negotiated correctly,

06:29.070 --> 06:30.633
full duplex, 100 Mb.

06:31.500 --> 06:35.767
This side do show interface f1/0/1,

06:39.300 --> 06:41.130
full duplex, 100 Mb.

06:41.130 --> 06:46.130
So we manually configured this side with speed and duplex.

06:47.850 --> 06:52.450
This side has been able

06:53.520 --> 06:56.793
to work out what the speed and duplex should be.

06:57.660 --> 07:01.470
So let's set the speed here to 10,

07:01.470 --> 07:04.613
and the duplex to half.

07:04.613 --> 07:08.010
(bell dinging)

07:08.010 --> 07:09.060
And let's see if the switches

07:09.060 --> 07:11.670
can successfully negotiate that.

07:11.670 --> 07:13.710
So interface has come up,

07:13.710 --> 07:16.680
show interface f1/0/1,

07:16.680 --> 07:20.190
and I'll simply include the duplex

07:20.190 --> 07:22.350
so we don't see all the output.

07:22.350 --> 07:24.603
Notice here it's negotiated properly.

07:26.220 --> 07:27.910
So on this switch

07:30.360 --> 07:34.140
it's been manually configured for half duplex, 10 Mb,

07:34.140 --> 07:37.260
and this switch has successfully negotiated that.

07:37.260 --> 07:40.023
If I change the duplex here to full,

07:41.880 --> 07:45.900
let's see what happens now when the interface comes up.

07:45.900 --> 07:48.330
So here it's 10 Mb, full duplex,

07:48.330 --> 07:51.690
on this side it's also 10 Mb, full duplex.

07:51.690 --> 07:56.690
So the 3750s are negotiating correctly without any problems,

07:58.230 --> 08:03.230
but that wasn't happening between a 3750 and a 2950.

08:05.820 --> 08:07.623
So let's set the speed to 100.

08:11.310 --> 08:16.310
So show interface and look at the duplex that's been set.

08:17.460 --> 08:18.930
Try that again.

08:18.930 --> 08:21.600
100, full duplex,

08:21.600 --> 08:24.630
this side 100, full duplex.

08:24.630 --> 08:28.320
So in this case, when I set the one side,

08:28.320 --> 08:31.260
it's successfully negotiating with the other side,

08:31.260 --> 08:33.150
but we had problems with negotiation

08:33.150 --> 08:35.880
between the 3750 and 2950.

08:35.880 --> 08:38.850
So generally the moral of the story is

08:38.850 --> 08:43.170
auto negotiation on both sides or hard code on both sides.

08:43.170 --> 08:46.590
Mixing and matching can cause problems.

08:46.590 --> 08:50.640
Today the general recommendation is use auto everywhere

08:50.640 --> 08:53.040
except perhaps between core links

08:53.040 --> 08:55.590
where you wanna hard code both sides

08:55.590 --> 08:58.743
to increase the speed of that interface coming up.
